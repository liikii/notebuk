Alphabetical index of directives
absolute_redirect
accept_mutex
accept_mutex_delay
access_log (ngx_http_log_module)
access_log (ngx_stream_log_module)
add_after_body
add_before_body
add_header
add_trailer
addition_types
aio
aio_write
alias
allow (ngx_http_access_module)
allow (ngx_stream_access_module)
ancient_browser
ancient_browser_value
api
auth_basic
auth_basic_user_file
auth_http
auth_http_header
auth_http_pass_client_cert
auth_http_timeout
auth_jwt
auth_jwt_claim_set
auth_jwt_header_set
auth_jwt_key_file
auth_jwt_leeway
auth_request
auth_request_set
autoindex
autoindex_exact_size
autoindex_format
autoindex_localtime
break
charset
charset_map
charset_types
chunked_transfer_encoding
client_body_buffer_size
client_body_in_file_only
client_body_in_single_buffer
client_body_temp_path
client_body_timeout
client_header_buffer_size
client_header_timeout
client_max_body_size
connection_pool_size
create_full_put_path
daemon
dav_access
dav_methods
debug_connection
debug_points
default_type
deny (ngx_http_access_module)
deny (ngx_stream_access_module)
directio
directio_alignment
disable_symlinks
empty_gif
env
error_log
error_page
etag
events
expires
f4f
f4f_buffer_size
fastcgi_bind
fastcgi_buffer_size
fastcgi_buffering
fastcgi_buffers
fastcgi_busy_buffers_size
fastcgi_cache
fastcgi_cache_background_update
fastcgi_cache_bypass
fastcgi_cache_key
fastcgi_cache_lock
fastcgi_cache_lock_age
fastcgi_cache_lock_timeout
fastcgi_cache_max_range_offset
fastcgi_cache_methods
fastcgi_cache_min_uses
fastcgi_cache_path
fastcgi_cache_purge
fastcgi_cache_revalidate
fastcgi_cache_use_stale
fastcgi_cache_valid
fastcgi_catch_stderr
fastcgi_connect_timeout
fastcgi_force_ranges
fastcgi_hide_header
fastcgi_ignore_client_abort
fastcgi_ignore_headers
fastcgi_index
fastcgi_intercept_errors
fastcgi_keep_conn
fastcgi_limit_rate
fastcgi_max_temp_file_size
fastcgi_next_upstream
fastcgi_next_upstream_timeout
fastcgi_next_upstream_tries
fastcgi_no_cache
fastcgi_param
fastcgi_pass
fastcgi_pass_header
fastcgi_pass_request_body
fastcgi_pass_request_headers
fastcgi_read_timeout
fastcgi_request_buffering
fastcgi_send_lowat
fastcgi_send_timeout
fastcgi_split_path_info
fastcgi_store
fastcgi_store_access
fastcgi_temp_file_write_size
fastcgi_temp_path
flv
geo (ngx_http_geo_module)
geo (ngx_stream_geo_module)
geoip_city (ngx_http_geoip_module)
geoip_city (ngx_stream_geoip_module)
geoip_country (ngx_http_geoip_module)
geoip_country (ngx_stream_geoip_module)
geoip_org (ngx_http_geoip_module)
geoip_org (ngx_stream_geoip_module)
geoip_proxy
geoip_proxy_recursive
google_perftools_profiles
grpc_bind
grpc_buffer_size
grpc_connect_timeout
grpc_hide_header
grpc_ignore_headers
grpc_intercept_errors
grpc_next_upstream
grpc_next_upstream_timeout
grpc_next_upstream_tries
grpc_pass
grpc_pass_header
grpc_read_timeout
grpc_send_timeout
grpc_set_header
grpc_ssl_certificate
grpc_ssl_certificate_key
grpc_ssl_ciphers
grpc_ssl_crl
grpc_ssl_name
grpc_ssl_password_file
grpc_ssl_protocols
grpc_ssl_server_name
grpc_ssl_session_reuse
grpc_ssl_trusted_certificate
grpc_ssl_verify
grpc_ssl_verify_depth
gunzip
gunzip_buffers
gzip
gzip_buffers
gzip_comp_level
gzip_disable
gzip_http_version
gzip_min_length
gzip_proxied
gzip_static
gzip_types
gzip_vary
hash (ngx_http_upstream_module)
hash (ngx_stream_upstream_module)
health_check (ngx_http_upstream_hc_module)
health_check (ngx_stream_upstream_hc_module)
health_check_timeout
hls
hls_buffers
hls_forward_args
hls_fragment
hls_mp4_buffer_size
hls_mp4_max_buffer_size
http
http2_body_preread_size
http2_chunk_size
http2_idle_timeout
http2_max_concurrent_pushes
http2_max_concurrent_streams
http2_max_field_size
http2_max_header_size
http2_max_requests
http2_push
http2_push_preload
http2_recv_buffer_size
http2_recv_timeout
if
if_modified_since
ignore_invalid_headers
image_filter
image_filter_buffer
image_filter_interlace
image_filter_jpeg_quality
image_filter_sharpen
image_filter_transparency
image_filter_webp_quality
imap_auth
imap_capabilities
imap_client_buffer
include
index
internal
ip_hash
js_access
js_content
js_filter
js_include (ngx_http_js_module)
js_include (ngx_stream_js_module)
js_preread
js_set (ngx_http_js_module)
js_set (ngx_stream_js_module)
keepalive
keepalive_disable
keepalive_requests
keepalive_timeout
keyval (ngx_http_keyval_module)
keyval (ngx_stream_keyval_module)
keyval_zone (ngx_http_keyval_module)
keyval_zone (ngx_stream_keyval_module)
large_client_header_buffers
least_conn (ngx_http_upstream_module)
least_conn (ngx_stream_upstream_module)
least_time (ngx_http_upstream_module)
least_time (ngx_stream_upstream_module)
limit_conn (ngx_http_limit_conn_module)
limit_conn (ngx_stream_limit_conn_module)
limit_conn_log_level (ngx_http_limit_conn_module)
limit_conn_log_level (ngx_stream_limit_conn_module)
limit_conn_status
limit_conn_zone (ngx_http_limit_conn_module)
limit_conn_zone (ngx_stream_limit_conn_module)
limit_except
limit_rate
limit_rate_after
limit_req
limit_req_log_level
limit_req_status
limit_req_zone
limit_zone
lingering_close
lingering_time
lingering_timeout
listen (ngx_http_core_module)
listen (ngx_mail_core_module)
listen (ngx_stream_core_module)
load_module
location
lock_file
log_format (ngx_http_log_module)
log_format (ngx_stream_log_module)
log_not_found
log_subrequest
mail
map (ngx_http_map_module)
map (ngx_stream_map_module)
map_hash_bucket_size (ngx_http_map_module)
map_hash_bucket_size (ngx_stream_map_module)
map_hash_max_size (ngx_http_map_module)
map_hash_max_size (ngx_stream_map_module)
master_process
match (ngx_http_upstream_hc_module)
match (ngx_stream_upstream_hc_module)
max_ranges
memcached_bind
memcached_buffer_size
memcached_connect_timeout
memcached_force_ranges
memcached_gzip_flag
memcached_next_upstream
memcached_next_upstream_timeout
memcached_next_upstream_tries
memcached_pass
memcached_read_timeout
memcached_send_timeout
merge_slashes
min_delete_depth
mirror
mirror_request_body
modern_browser
modern_browser_value
mp4
mp4_buffer_size
mp4_limit_rate
mp4_limit_rate_after
mp4_max_buffer_size
msie_padding
msie_refresh
multi_accept
ntlm
open_file_cache
open_file_cache_errors
open_file_cache_min_uses
open_file_cache_valid
open_log_file_cache (ngx_http_log_module)
open_log_file_cache (ngx_stream_log_module)
output_buffers
override_charset
pcre_jit
perl
perl_modules
perl_require
perl_set
pid
pop3_auth
pop3_capabilities
port_in_redirect
postpone_output
preread_buffer_size
preread_timeout
protocol
proxy_bind (ngx_http_proxy_module)
proxy_bind (ngx_stream_proxy_module)
proxy_buffer
proxy_buffer_size (ngx_http_proxy_module)
proxy_buffer_size (ngx_stream_proxy_module)
proxy_buffering
proxy_buffers
proxy_busy_buffers_size
proxy_cache
proxy_cache_background_update
proxy_cache_bypass
proxy_cache_convert_head
proxy_cache_key
proxy_cache_lock
proxy_cache_lock_age
proxy_cache_lock_timeout
proxy_cache_max_range_offset
proxy_cache_methods
proxy_cache_min_uses
proxy_cache_path
proxy_cache_purge
proxy_cache_revalidate
proxy_cache_use_stale
proxy_cache_valid
proxy_connect_timeout (ngx_http_proxy_module)
proxy_connect_timeout (ngx_stream_proxy_module)
proxy_cookie_domain
proxy_cookie_path
proxy_download_rate
proxy_force_ranges
proxy_headers_hash_bucket_size
proxy_headers_hash_max_size
proxy_hide_header
proxy_http_version
proxy_ignore_client_abort
proxy_ignore_headers
proxy_intercept_errors
proxy_limit_rate
proxy_max_temp_file_size
proxy_method
proxy_next_upstream (ngx_http_proxy_module)
proxy_next_upstream (ngx_stream_proxy_module)
proxy_next_upstream_timeout (ngx_http_proxy_module)
proxy_next_upstream_timeout (ngx_stream_proxy_module)
proxy_next_upstream_tries (ngx_http_proxy_module)
proxy_next_upstream_tries (ngx_stream_proxy_module)
proxy_no_cache
proxy_pass (ngx_http_proxy_module)
proxy_pass (ngx_stream_proxy_module)
proxy_pass_error_message
proxy_pass_header
proxy_pass_request_body
proxy_pass_request_headers
proxy_protocol
proxy_protocol_timeout
proxy_read_timeout
proxy_redirect
proxy_request_buffering
proxy_responses
proxy_send_lowat
proxy_send_timeout
proxy_set_body
proxy_set_header
proxy_ssl
proxy_ssl_certificate (ngx_http_proxy_module)
proxy_ssl_certificate (ngx_stream_proxy_module)
proxy_ssl_certificate_key (ngx_http_proxy_module)
proxy_ssl_certificate_key (ngx_stream_proxy_module)
proxy_ssl_ciphers (ngx_http_proxy_module)
proxy_ssl_ciphers (ngx_stream_proxy_module)
proxy_ssl_crl (ngx_http_proxy_module)
proxy_ssl_crl (ngx_stream_proxy_module)
proxy_ssl_name (ngx_http_proxy_module)
proxy_ssl_name (ngx_stream_proxy_module)
proxy_ssl_password_file (ngx_http_proxy_module)
proxy_ssl_password_file (ngx_stream_proxy_module)
proxy_ssl_protocols (ngx_http_proxy_module)
proxy_ssl_protocols (ngx_stream_proxy_module)
proxy_ssl_server_name (ngx_http_proxy_module)
proxy_ssl_server_name (ngx_stream_proxy_module)
proxy_ssl_session_reuse (ngx_http_proxy_module)
proxy_ssl_session_reuse (ngx_stream_proxy_module)
proxy_ssl_trusted_certificate (ngx_http_proxy_module)
proxy_ssl_trusted_certificate (ngx_stream_proxy_module)
proxy_ssl_verify (ngx_http_proxy_module)
proxy_ssl_verify (ngx_stream_proxy_module)
proxy_ssl_verify_depth (ngx_http_proxy_module)
proxy_ssl_verify_depth (ngx_stream_proxy_module)
proxy_store
proxy_store_access
proxy_temp_file_write_size
proxy_temp_path
proxy_timeout (ngx_mail_proxy_module)
proxy_timeout (ngx_stream_proxy_module)
proxy_upload_rate
queue
random_index
read_ahead
real_ip_header
real_ip_recursive
recursive_error_pages
referer_hash_bucket_size
referer_hash_max_size
request_pool_size
reset_timedout_connection
resolver (ngx_http_core_module)
resolver (ngx_mail_core_module)
resolver (ngx_stream_core_module)
resolver_timeout (ngx_http_core_module)
resolver_timeout (ngx_mail_core_module)
resolver_timeout (ngx_stream_core_module)
return (ngx_http_rewrite_module)
return (ngx_stream_return_module)
rewrite
rewrite_log
root
satisfy
scgi_bind
scgi_buffer_size
scgi_buffering
scgi_buffers
scgi_busy_buffers_size
scgi_cache
scgi_cache_background_update
scgi_cache_bypass
scgi_cache_key
scgi_cache_lock
scgi_cache_lock_age
scgi_cache_lock_timeout
scgi_cache_max_range_offset
scgi_cache_methods
scgi_cache_min_uses
scgi_cache_path
scgi_cache_purge
scgi_cache_revalidate
scgi_cache_use_stale
scgi_cache_valid
scgi_connect_timeout
scgi_force_ranges
scgi_hide_header
scgi_ignore_client_abort
scgi_ignore_headers
scgi_intercept_errors
scgi_limit_rate
scgi_max_temp_file_size
scgi_next_upstream
scgi_next_upstream_timeout
scgi_next_upstream_tries
scgi_no_cache
scgi_param
scgi_pass
scgi_pass_header
scgi_pass_request_body
scgi_pass_request_headers
scgi_read_timeout
scgi_request_buffering
scgi_send_timeout
scgi_store
scgi_store_access
scgi_temp_file_write_size
scgi_temp_path
secure_link
secure_link_md5
secure_link_secret
send_lowat
send_timeout
sendfile
sendfile_max_chunk
server (ngx_http_core_module)
server (ngx_http_upstream_module)
server (ngx_mail_core_module)
server (ngx_stream_core_module)
server (ngx_stream_upstream_module)
server_name (ngx_http_core_module)
server_name (ngx_mail_core_module)
server_name_in_redirect
server_names_hash_bucket_size
server_names_hash_max_size
server_tokens
session_log
session_log_format
session_log_zone
set
set_real_ip_from (ngx_http_realip_module)
set_real_ip_from (ngx_stream_realip_module)
slice
smtp_auth
smtp_capabilities
smtp_client_buffer
smtp_greeting_delay
source_charset
spdy_chunk_size
spdy_headers_comp
split_clients (ngx_http_split_clients_module)
split_clients (ngx_stream_split_clients_module)
ssi
ssi_last_modified
ssi_min_file_chunk
ssi_silent_errors
ssi_types
ssi_value_length
ssl (ngx_http_ssl_module)
ssl (ngx_mail_ssl_module)
ssl_buffer_size
ssl_certificate (ngx_http_ssl_module)
ssl_certificate (ngx_mail_ssl_module)
ssl_certificate (ngx_stream_ssl_module)
ssl_certificate_key (ngx_http_ssl_module)
ssl_certificate_key (ngx_mail_ssl_module)
ssl_certificate_key (ngx_stream_ssl_module)
ssl_ciphers (ngx_http_ssl_module)
ssl_ciphers (ngx_mail_ssl_module)
ssl_ciphers (ngx_stream_ssl_module)
ssl_client_certificate (ngx_http_ssl_module)
ssl_client_certificate (ngx_mail_ssl_module)
ssl_client_certificate (ngx_stream_ssl_module)
ssl_crl (ngx_http_ssl_module)
ssl_crl (ngx_mail_ssl_module)
ssl_crl (ngx_stream_ssl_module)
ssl_dhparam (ngx_http_ssl_module)
ssl_dhparam (ngx_mail_ssl_module)
ssl_dhparam (ngx_stream_ssl_module)
ssl_ecdh_curve (ngx_http_ssl_module)
ssl_ecdh_curve (ngx_mail_ssl_module)
ssl_ecdh_curve (ngx_stream_ssl_module)
ssl_engine
ssl_handshake_timeout
ssl_password_file (ngx_http_ssl_module)
ssl_password_file (ngx_mail_ssl_module)
ssl_password_file (ngx_stream_ssl_module)
ssl_prefer_server_ciphers (ngx_http_ssl_module)
ssl_prefer_server_ciphers (ngx_mail_ssl_module)
ssl_prefer_server_ciphers (ngx_stream_ssl_module)
ssl_preread
ssl_protocols (ngx_http_ssl_module)
ssl_protocols (ngx_mail_ssl_module)
ssl_protocols (ngx_stream_ssl_module)
ssl_session_cache (ngx_http_ssl_module)
ssl_session_cache (ngx_mail_ssl_module)
ssl_session_cache (ngx_stream_ssl_module)
ssl_session_ticket_key (ngx_http_ssl_module)
ssl_session_ticket_key (ngx_mail_ssl_module)
ssl_session_ticket_key (ngx_stream_ssl_module)
ssl_session_tickets (ngx_http_ssl_module)
ssl_session_tickets (ngx_mail_ssl_module)
ssl_session_tickets (ngx_stream_ssl_module)
ssl_session_timeout (ngx_http_ssl_module)
ssl_session_timeout (ngx_mail_ssl_module)
ssl_session_timeout (ngx_stream_ssl_module)
ssl_stapling
ssl_stapling_file
ssl_stapling_responder
ssl_stapling_verify
ssl_trusted_certificate (ngx_http_ssl_module)
ssl_trusted_certificate (ngx_mail_ssl_module)
ssl_trusted_certificate (ngx_stream_ssl_module)
ssl_verify_client (ngx_http_ssl_module)
ssl_verify_client (ngx_mail_ssl_module)
ssl_verify_client (ngx_stream_ssl_module)
ssl_verify_depth (ngx_http_ssl_module)
ssl_verify_depth (ngx_mail_ssl_module)
ssl_verify_depth (ngx_stream_ssl_module)
starttls
state (ngx_http_upstream_module)
state (ngx_stream_upstream_module)
status
status_format
status_zone
sticky
sticky_cookie_insert
stream
stub_status
sub_filter
sub_filter_last_modified
sub_filter_once
sub_filter_types
subrequest_output_buffer_size
tcp_nodelay (ngx_http_core_module)
tcp_nodelay (ngx_stream_core_module)
tcp_nopush
thread_pool
timeout
timer_resolution
try_files
types
types_hash_bucket_size
types_hash_max_size
underscores_in_headers
uninitialized_variable_warn
upstream (ngx_http_upstream_module)
upstream (ngx_stream_upstream_module)
upstream_conf
use
user
userid
userid_domain
userid_expires
userid_mark
userid_name
userid_p3p
userid_path
userid_service
uwsgi_bind
uwsgi_buffer_size
uwsgi_buffering
uwsgi_buffers
uwsgi_busy_buffers_size
uwsgi_cache
uwsgi_cache_background_update
uwsgi_cache_bypass
uwsgi_cache_key
uwsgi_cache_lock
uwsgi_cache_lock_age
uwsgi_cache_lock_timeout
uwsgi_cache_max_range_offset
uwsgi_cache_methods
uwsgi_cache_min_uses
uwsgi_cache_path
uwsgi_cache_purge
uwsgi_cache_revalidate
uwsgi_cache_use_stale
uwsgi_cache_valid
uwsgi_connect_timeout
uwsgi_force_ranges
uwsgi_hide_header
uwsgi_ignore_client_abort
uwsgi_ignore_headers
uwsgi_intercept_errors
uwsgi_limit_rate
uwsgi_max_temp_file_size
uwsgi_modifier1
uwsgi_modifier2
uwsgi_next_upstream
uwsgi_next_upstream_timeout
uwsgi_next_upstream_tries
uwsgi_no_cache
uwsgi_param
uwsgi_pass
uwsgi_pass_header
uwsgi_pass_request_body
uwsgi_pass_request_headers
uwsgi_read_timeout
uwsgi_request_buffering
uwsgi_send_timeout
uwsgi_ssl_certificate
uwsgi_ssl_certificate_key
uwsgi_ssl_ciphers
uwsgi_ssl_crl
uwsgi_ssl_name
uwsgi_ssl_password_file
uwsgi_ssl_protocols
uwsgi_ssl_server_name
uwsgi_ssl_session_reuse
uwsgi_ssl_trusted_certificate
uwsgi_ssl_verify
uwsgi_ssl_verify_depth
uwsgi_store
uwsgi_store_access
uwsgi_temp_file_write_size
uwsgi_temp_path
valid_referers
variables_hash_bucket_size (ngx_http_core_module)
variables_hash_bucket_size (ngx_stream_core_module)
variables_hash_max_size (ngx_http_core_module)
variables_hash_max_size (ngx_stream_core_module)
worker_aio_requests
worker_connections
worker_cpu_affinity
worker_priority
worker_processes
worker_rlimit_core
worker_rlimit_nofile
worker_shutdown_timeout
working_directory
xclient
xml_entities
xslt_last_modified
xslt_param
xslt_string_param
xslt_stylesheet
xslt_types
zone (ngx_http_upstream_module)
zone (ngx_stream_upstream_module)
zone_sync
zone_sync_buffers
zone_sync_connect_retry_interval
zone_sync_connect_timeout
zone_sync_interval
zone_sync_recv_buffer_size
zone_sync_server
zone_sync_ssl
zone_sync_ssl_certificate
zone_sync_ssl_certificate_key
zone_sync_ssl_ciphers
zone_sync_ssl_crl
zone_sync_ssl_password_file
zone_sync_ssl_protocols
zone_sync_ssl_trusted_certificate
zone_sync_ssl_verify
zone_sync_ssl_verify_depth
zone_sync_timeout







sudo nginx -c /etc/nginx/nginx.conf -t

nginx -v 2>&1

add dynanmic module:


wget -P /tmp http://nginx.org/download/nginx-1.6.2.tar.gz
tar -zxvf /tmp/nginx-1.6.2.tar.gz -C /tmp

wget -P /tmp https://github.com/vkholodkov/nginx-upload-module/archive/2.2.0.tar.gz
tar -zxvf /tmp/2.2.0.tar.gz -C /tmp

cd /tmp/nginx-1.6.2

./configure --add-module=/tmp/nginx-upload-module-2.2.0
make
make install


sudo nano /etc/nginx/nginx.conf
add add below in the main context:

load_module "modules/ngx_http_geoip_module.so";




Nginx 10k concurrent connections
Ask Question
up vote
7
down vote
favorite
8
We are not able to handle more than 3k concurrent request in nginx (Connecton time out). We change also the ulimit to 20000. Following are my nginx.conf and sysctl.conf files:




user www-data; 
worker_processes 4; 
pid /var/run/nginx.pid;
events {
     worker_connections 5000;
     use epoll;
     # multi_accept on; 
} # took it in next line
worker_rlimit_nofile    100000;

http {
     sendfile on;
     tcp_nopush on;
     tcp_nodelay on;
     keepalive_timeout 600;
     send_timeout 600;
     proxy_connect_timeout       600;
     proxy_send_timeout          600;
     proxy_read_timeout          600;
     reset_timedout_connection on;
     types_hash_max_size 2048;
     client_header_buffer_size 5k;
     open_file_cache max=10000 inactive=30s;
     open_file_cache_valid    60s;
     open_file_cache_min_uses 2;
     open_file_cache_errors   on;
     include /etc/nginx/mime.types;
     default_type application/octet-stream;
     access_log off; 
     error_log /var/log/nginx/error.log;
     gzip on;
     gzip_disable "msie6";
     include /etc/nginx/conf.d/*.conf;
     include /etc/nginx/sites-enabled/*; 
}
systel.conf

# Increase size of file handles and inode cache
fs.file-max = 2097152

# Do less swapping
vm.swappiness = 10
vm.dirty_ratio = 60
vm.dirty_background_ratio = 2

### GENERAL NETWORK SECURITY OPTIONS ###

# Number of times SYNACKs for passive TCP connection.
net.ipv4.tcp_synack_retries = 2

# Allowed local port range
net.ipv4.ip_local_port_range = 2000 65535

# Protect Against TCP Time-Wait
net.ipv4.tcp_rfc1337 = 1

# Decrease the time default value for tcp_fin_timeout connection
net.ipv4.tcp_fin_timeout = 15

# Decrease the time default value for connections to keep alive
net.ipv4.tcp_keepalive_time = 300
net.ipv4.tcp_keepalive_probes = 5
net.ipv4.tcp_keepalive_intvl = 15

### TUNING NETWORK PERFORMANCE ###

# Default Socket Receive Buffer
net.core.rmem_default = 31457280

# Maximum Socket Receive Buffer
net.core.rmem_max = 12582912

# Default Socket Send Buffer
net.core.wmem_default = 31457280

# Maximum Socket Send Buffer
net.core.wmem_max = 12582912

# Increase number of incoming connections
net.core.somaxconn = 65535

# Increase number of incoming connections backlog
net.core.netdev_max_backlog = 65536

# Increase the maximum amount of option memory buffers
net.core.optmem_max = 25165824

# Increase the maximum total buffer-space allocatable
# This is measured in units of pages (4096 bytes)
net.ipv4.tcp_mem = 65536 131072 262144
net.ipv4.udp_mem = 65536 131072 262144

# Increase the read-buffer space allocatable
net.ipv4.tcp_rmem = 8192 87380 16777216
net.ipv4.udp_rmem_min = 16384

# Increase the write-buffer-space allocatable
net.ipv4.tcp_wmem = 8192 65536 16777216
net.ipv4.udp_wmem_min = 16384

# Increase the tcp-time-wait buckets pool size to prevent simple DOS attacks
net.ipv4.tcp_max_tw_buckets = 1440000
net.ipv4.tcp_tw_recycle = 1
net.ipv4.tcp_tw_reuse = 1
We are using ubuntu OS with 4 CPU and 8 GB RAM. I hardly see any CPU and RAM usage. I am just firing nginx default page URL.


  vim /etc/sysctl.conf 
 1986  sysctl -p
 1987  sudo sysctl -p
 1988  sudo sysctl -a | grep somaxconn
 1989  sudo sysctl -a
 1990  sudo sysctl -a | grep 128
 1991  sysctl -a
 1992  sysctl -a | grep 128
 1993  sudo vim /etc/sysctl.conf 
 1994  source /etc/sysctl.conf




set file descriptor limit.
. 
/etc/security/limits.conf

*       soft    nproc           32768
*       hard    nproc           32768
*       soft    nofile           32768
*       hard    nofile           32768

*重进shell

2.
/etc/sysctl.conf
见linux设置

sudo sysctl -p

3.
nginx 设置

5.
查看系统限制
ulimit -a

查看系统文件描述符限制
cat /proc/sys/fs/file-max

查看系统最大socket数
sudo sysctl -a | grep somaxconn


查看端口占用
sudo netstat  -aultpn | grep 8080 | wc -l
sudo netstat  -aultpn | grep 8080 | grep nginx | wc -l
sudo netstat  -aultpn | grep 8080 | grep java | wc -l
sudo netstat  -aultpn | grep ':80 ' | wc -l

查看进程文件描述符
sudo lsof -p
sudo lsof -p 4362,4363,4364,4365 | grep 'cn-north-1.compute.internal' | wc -l

nginx设置
worker_rlimit_nofile 65535;


